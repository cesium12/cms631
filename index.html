<!DOCTYPE html>
<html class="full">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>oprofile</title>
  <style type="text/css">
body {
  margin: 0;
  line-height: 0;
  overflow: hidden;
  background: url(swirla.png) center center;
  background-color: black;
}

.full {
  width: 100%;
  height: 100%;
}

#all {
  position: absolute;
  width: 100%;
  height: 100%;
  border-spacing: 0;
}

#info {
  border: 2px solid lightgray;
  border-bottom: none;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 4;
}

#plot, #plot > div {
  z-index: 0;
  position: relative;
  overflow: hidden;
  padding: 0;
}

#line, #lover, #plotc {
  position: absolute;
  left: 0;
  top: 0;
}

#lover {
  z-index: 2;
}

#plotc > div {
  border: 1px solid gray;
  position: absolute;
  margin: -8px;
  width: 14px;
  height: 14px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

#plotc > div.select {
  margin: -11px;
  width: 20px;
  height: 20px;
  box-shadow: 0 0 20px white;
}

#plotc > div.highlight {
  box-shadow: 0 0 14px lightgray;
}

.text {
  font-size: 12pt;
  line-height: 1.5em;
  color: white;
  text-decoration: none;
  white-space: nowrap;
}

#legend, #info {
  font-family: "Droid Sans Mono", sans-serif;
}

#container, #spiel {
  font-family: "Tinos", serif;
}

#container, #info {
  text-align: center;
  vertical-align: middle;
}

#legend, #spiel {
  width: 270pt;
  vertical-align: top;
}

#legend {
  text-align: left;
  padding-right: 0px;
}

#legend:hover {
  padding-right: 1px;
}

#spiel {
  white-space: normal;
  text-align: justify;
  padding: 1em;
}

#bar {
  height: 120px;
}

#container {
  margin: auto;
  border-spacing: 40px 0px;
  height: 100%;
}

.label img {
  height: 80px;
  width: 80px;
}

.label div {
  margin-top: -1em;
}

.label img:first-of-type {
  position: absolute;
}

.label.used, .label:hover {
  text-shadow: 0px 0px 1em white, 0px 0px 1em white, 0px 0px 1em white;
}

.label:not(.used):not(:hover) > img:first-of-type {
  opacity: 0;
}

.label.used > img:last-of-type, .label:hover > img:last-of-type {
  opacity: 0;
}
  </style>
  <script src="jquery.min.js"></script>
  <script src="arbor/lib/arbor.js"></script>
  <script src="callgrind.js"></script>
  <script>
var lctx, loctx, gsize, lsize, minsize, select = null, zoom, enable = true, interval;

interval = setInterval(function() {
  $('#info').text(($('#info').text() + '.').replace('....', ''));
}, 500);

function main() {
  lctx = $('#line')[0].getContext('2d');
  loctx = $('#lover')[0].getContext('2d');
  $(window).resize(function() {
    gsize = $('#line').height();
    lsize = $('#line').width();
    minsize = Math.min(gsize, lsize);
    $('#line,#lover').attr({ height: gsize, width: lsize });
  }).resize();
  zoom = minsize - 20;
  
  $(document).mousemove(function(event) {
    select = [ event.pageX - $('#lover').offset().left,
               event.pageY - $('#lover').offset().top ];
  }).mouseout(function() {
    select = null;
  }).keypress(function(event) {
    switch(event.which) {
      case 45:
        zoom /= 1.1; break;
      case 61:
        zoom *= 1.1; break;
    }
  });
  
  $.getJSON('oprofile/grind.json', function(nodes) {
    clearInterval(interval);
    var cg = new Callgrind(nodes);
    $.getJSON('config.json', function(config) {
      $('#spiel').html(config.description._main);
      $('#info').html('&nbsp;');
      for(var id in config.binary) {
        var fn = config.binary[id],
            dim = function(x) { return { width: x, height: x }; },
            button = $('<a>').addClass('text label').attr('href', '#')
                             .html('<img src="logos/' + id + ' s.png">' +
                                   '<img src="logos/' + id + '.png">' +
                                   '<div>' + id + '</div>');
        $('<td>').html(button).appendTo('#container tr');
        button.toggle((function(fn, button) {
          return function() {
            $(window).resize();
            button.addClass('used');
            cg.add(fn);
            $('#spiel').html(config.description[fn]);
          };
        })(fn, button), (function(fn, button) {
          return function() {
            $(window).resize();
            button.removeClass('used');
            cg.remove(fn);
          }
        })(fn, button));
        function ex(size) {
          var logo = button.find('img');
          return function() {
            if(!enable)
              return;
            logo.stop().animate(dim(size), 'fast');
          };
        }
        button.mouseover(ex(100)).mouseout(ex(80));
      }
    }).overrideMimeType('application/json');
  }).overrideMimeType('application/json');
}

WebFontConfig = {
  google : { families : [ 'Philosopher', 'Tinos', 'Droid Sans Mono' ] },
  active : function() { $(main); }
};
  </script>
  <script async="async" src="http://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"></script>
</head>
<body class="full">
  <table id="all" class="full">
    <tr>
      <td rowspan="2" class="text" id="legend">
        <div id="cats" style="position: absolute;"></div>
      </td>
      <td id="bar">
        <table id="container">
          <tr></tr>
        </table>
      </td>
      <td rowspan="2" class="text" id="spiel"></td>
    </tr>
    <tr class="full">
      <td id="plot">
        <div class="full">
          <canvas class="full" id="line"></canvas>
          <canvas class="full" id="lover"></canvas>
          <div class="text" id="info">loading</div>
          <div class="full" id="plotc"></div>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>
