<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>?</title>
  <style type="text/css">
html, body {
  height: 100%;
}

body {
  margin: 0;
  line-height: 0;
  overflow: hidden;
  background-color: black;
  width: 100%;
}

.full {
  position: absolute;
  top: 0;
  left: 0;
}

#back {
  position: absolute;
  width: 100%;
}

#lover {
  z-index: 2;
}

#plot {
  z-index: 0;
}

#plot > div {
  border: 1px solid gray;
  position: absolute;
  margin: -8px;
  width: 14px;
  height: 14px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

#plot > div.select {
  margin: -11px;
  width: 20px;
  height: 20px;
  box-shadow: 0 0 20px white;
}

#plot > div.highlight {
  box-shadow: 0 0 14px lightgray;
}

.text {
  font-size: 12pt;
  line-height: 1em;
  color: white;
  text-decoration: none;
  white-space: nowrap;
}

#info {
  position: fixed;
  top: 0;
  right: 0;
  font-family: "Droid Sans Mono", sans-serif;
  text-align: right;
}

#container {
  height: 100%;
  margin: auto;
  border-spacing: 40px 0px;
  position: relative;
  z-index: 2;
}

.label {
  font-family: "Tinos", serif;
  text-align: center;
  vertical-align: middle;
}

.label img {
  height: 80px;
  width: 80px;
}

.label div {
  margin-top: -3px;
}

.label img:first-of-type {
  position: absolute;
}

.label:hover {
  text-shadow: 0px 0px 1em white, 0px 0px 1em white, 0px 0px 1em white;
}

.label:not(:hover) > img:first-of-type {
  display: none;
}
  </style>
  <script src="jquery.min.js"></script>
  <script src="jquery.mousewheel.min.js"></script>
  <script src="callgrind.js"></script>
  <script>
var lctx, loctx, gsize, lsize, minsize, select = null, zoom = 0, minzoom = 0, enable = true;

function main() {
  lctx = $('#line')[0].getContext('2d');
  loctx = $('#lover')[0].getContext('2d');
  
  $(window).resize(function() {
    gsize = $(window).height();
    lsize = $(window).width();
    minsize = Math.min(gsize, lsize);
    $('.full').css({ height: gsize, width: lsize });
    $('canvas.full').attr({ height: gsize, width: lsize });
  }).resize();
  
  $(document).mousemove(function(event) {
    select = [ event.pageX, event.pageY ];
  }).mouseout(function() {
    select = null;
  }).keypress(function(event) {
    if(minzoom)
      switch(event.which) {
        case 45:
          zoom /= 1.1; break;
        case 61:
          zoom *= 1.1; break;
      }
  });
  
  $.getJSON('config.json', function(config) {
    for(var i = 0; i < config.callgrind.length; ++i) {
      var id = config.callgrind[i],
          dim = function(x) { return { width: x, height: x }; },
          button = $('<a>').addClass('text label').attr('href', '#')
                           .html('<img src="' + id + '/logos.png">' +
                                 '<img src="' + id + '/logo.png">' +
                                 '<div>' + id + '</div>');
      $('<td>').html(button).appendTo('#container tr');
      button.click((function(id) {
        var logo = button.find('img');
        return function() {
          if(!enable)
            return;
          enable = false;
          var cg = new Callgrind(id, function() {
            minzoom = 0;
            $('#back,#container').fadeIn(2000);
            logo.animate(dim(80), {
              duration: 3000,
              step: function(now) { zoom = now; },
              complete: function() { cg.kill(); delete cg; enable = true; }
            });
          }, [ logo.offset().left + 40, logo.offset().top + 40 ]);
          $('#back,#container').fadeOut(2000);
          logo.animate(dim(320), {
            duration: 3000,
            step: function(now) { zoom = now; },
            complete: function() { logo.css(dim(160)); minzoom = 160; }
          });
        };
      })(id));
    }
  }).overrideMimeType("application/json");
}

WebFontConfig = {
  google : { families : [ 'Philosopher', 'Tinos', 'Droid Sans Mono' ] },
  active : function() { $(main); }
};
  </script>
  <script async="true" src="http://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"></script>
</head>
<body>
  <div class="full" id="plot">
    <canvas class="full" id="line"></canvas>
    <canvas class="full" id="lover"></canvas>
  </div>
  <img id="back" src="bliss.jpg">
  <div class="text" id="info"></div>
  <table id="container">
    <tr></tr>
  </table>
</body>
</html>
